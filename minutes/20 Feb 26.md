# Transaction History Endpoint Review Meeting

## Action Items

- Share missing wallet details and example transactions with the team
- Verify the new transaction‑history endpoint works for BTC and swap records; report any gaps
- Add the trace-id header to all backend requests and confirm it propagates end‑to‑end
- Provide updated access token / credentials to the mobile team (Francesco, Dario, etc.)
- Send the latest Swagger / API contract link to Alex for review before the flight
- Follow up with Vigan on final endpoint naming and any required refactor

## Transaction History Endpoint

- New grouped endpoint aggregates transfers, swaps, BTC change outputs, and gasless actions
- Returns one logical transaction per transactionHash with type field (send/receive/swap)
- Backward‑compatible read‑side aggregation, no ingestion changes needed
- Addresses missing BTC and swap entries reported by mobile team
- Phase 1 focuses on core chain‑level grouping; Phase 2 adds Rumble enrichment (tips, channels)

## Wallet Relation Filter Issue

- getUserWallets applies a **relation filter** on type=related / relationType param
- Filter can return “wallets not found” even when wallet exists if relation mapping missing
- Issue observed in staging: related wallet queries 404, user‑only queries succeed
- Need to trace shard worker logic and ensure relation data is populated before ownership check

## Notification Token Handling

- Backend expects FCM tokens; iOS Expo provides APN tokens → notifications fail
- Temporary fix: use React Native Firebase Messaging (v1) to obtain FCM token on iOS
- Long‑term: consider on‑fly conversion from FCM to APN token or unify messaging stack

## Spark Indexing & Address Fields

- Spark balance reads hit rate limits; possible rapid‑fire queries or missing index warm‑up
- New address fields added in indexer but not yet indexed; pending architecture decision with Vigan
- Need to finalize where to store and index these fields for both Spark and Rumble use cases

## Documentation & Specs

- Transaction History spec in .md file (Transaction History API v2) shared with team
- Usman working on Swagger / API docs; Alex to receive link for offline review
- Internal \___TRUTH.md contains full indexing architecture details – review before next call

## Timeline & Phases

- Phase 1 (core grouping) targeted for end‑of‑day today; code review tomorrow, merge to staging by week‑end
- Phase 2 (Rumble enrichment) will follow once Phase 1 is stable in staging
- Spark address‑field work to be discussed with Vigan today; decision expected within the day

## Trace ID Header

- Introduce trace-id header on all backend calls to enable end‑to‑end request tracing
- Francesco to broadcast header usage to mobile team; Alex to verify implementation across services

## Credentials Sharing

- Need a single shared password for metadata API access; rotate regularly for security
- Francisco to distribute credentials to team members (Lea, Matthias, Christina, etc.)
- Ensure Alex has the correct token for testing related‑wallet queries

## Open Questions / Follow‑ups

- Will seed‑phrase users receive only core transaction history without Rumble context? (Yes, Phase 1)
- Confirmation on final endpoint naming (empowerment vs new endpoint) after Vigan’s input
- Availability of updated Swagger spec for Alex before his flight tonight
- Status of plasma vs Spark priority for indexing work – Dario to clarify next steps
